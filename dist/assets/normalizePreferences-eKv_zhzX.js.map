{"version":3,"file":"normalizePreferences-eKv_zhzX.js","sources":["../../utils/storage/normalizePreferences.ts"],"sourcesContent":["import { UserPreferences } from '../../types/index';\n\n// Normalize a time string to HH:MM:SS if possible; otherwise return input\nfunction toHHMMSS(input: any): any {\n  if (typeof input !== 'string') return input;\n  try {\n    const parts = input.split(':');\n    if (parts.length >= 3) {\n      const hh = parts[0].padStart(2, '0');\n      const mm = parts[1].padStart(2, '0');\n      const ss = (parts[2] ?? '00').padStart(2, '0');\n      return `${hh}:${mm}:${ss}`;\n    } else if (parts.length === 2) {\n      const hh = parts[0].padStart(2, '0');\n      const mm = parts[1].padStart(2, '0');\n      return `${hh}:${mm}:00`;\n    }\n    return input;\n  } catch {\n    return input;\n  }\n}\n\n// Stable-sort non-semantic arrays (working days, categories). Do not sort arrays where order matters.\nfunction stableSortIfNonSemantic(key: keyof UserPreferences, value: any): any {\n  const nonSemanticArrays: (keyof UserPreferences)[] = [\n    'calendar_working_days',\n    'preferred_categories',\n  ];\n  if (!Array.isArray(value)) return value;\n  if (!nonSemanticArrays.includes(key)) return value;\n  return [...value].slice().sort((a, b) => String(a).localeCompare(String(b)));\n}\n\n// Coerce undefineds to defaults for boolean/array fields to avoid spurious diffs\nfunction coerceDefaults(key: keyof UserPreferences, value: any): any {\n  const booleanDefaults: (keyof UserPreferences)[] = [\n    'autostart', 'show_timer', 'daily_reminder', 'notification_activity_reminders',\n    'notification_upcoming_gaps', 'dark_mode', 'sound_enabled', 'vibration_enabled',\n    'learning_enabled', 'habit_tracking_enabled', 'manual_mode', 'demo_mode', 'onboarding_completed',\n    'show_device_calendar_busy', 'show_device_calendar_titles'\n  ];\n  const arrayDefaults: (keyof UserPreferences)[] = [\n    'calendar_working_days', 'preferred_categories', 'preferred_activity_durations', 'device_calendar_included_ids'\n  ];\n  if (value === undefined) {\n    if (booleanDefaults.includes(key)) return false;\n    if (arrayDefaults.includes(key)) return [];\n  }\n  return value;\n}\n\nexport function normalizeForCompare(prefs: Partial<UserPreferences>): Partial<UserPreferences> {\n  if (!prefs) return {};\n  const out: Partial<UserPreferences> = { ...prefs };\n\n  // Times\n  if (out.calendar_work_start !== undefined) out.calendar_work_start = toHHMMSS(out.calendar_work_start);\n  if (out.calendar_work_end !== undefined) out.calendar_work_end = toHHMMSS(out.calendar_work_end);\n\n  // Arrays (stable-sort where order non-semantic)\n  if (out.calendar_working_days !== undefined) out.calendar_working_days = stableSortIfNonSemantic('calendar_working_days', out.calendar_working_days);\n  if (out.preferred_categories !== undefined) out.preferred_categories = stableSortIfNonSemantic('preferred_categories', out.preferred_categories);\n\n  // Coerce defaults for booleans/arrays\n  for (const key of Object.keys(out) as (keyof UserPreferences)[]) {\n    (out as any)[key] = coerceDefaults(key, (out as any)[key]);\n  }\n\n  return out;\n}\n\n\n"],"names":["toHHMMSS","input","parts","hh","mm","ss","stableSortIfNonSemantic","key","value","nonSemanticArrays","a","b","coerceDefaults","booleanDefaults","arrayDefaults","normalizeForCompare","prefs","out"],"mappings":"AAGA,SAASA,EAASC,EAAiB,CACjC,GAAI,OAAOA,GAAU,SAAU,OAAOA,EACtC,GAAI,CACF,MAAMC,EAAQD,EAAM,MAAM,GAAG,EAC7B,GAAIC,EAAM,QAAU,EAAG,CACrB,MAAMC,EAAKD,EAAM,CAAC,EAAE,SAAS,EAAG,GAAG,EAC7BE,EAAKF,EAAM,CAAC,EAAE,SAAS,EAAG,GAAG,EAC7BG,GAAMH,EAAM,CAAC,GAAK,MAAM,SAAS,EAAG,GAAG,EAC7C,MAAO,GAAGC,CAAE,IAAIC,CAAE,IAAIC,CAAE,EAC1B,SAAWH,EAAM,SAAW,EAAG,CAC7B,MAAMC,EAAKD,EAAM,CAAC,EAAE,SAAS,EAAG,GAAG,EAC7BE,EAAKF,EAAM,CAAC,EAAE,SAAS,EAAG,GAAG,EACnC,MAAO,GAAGC,CAAE,IAAIC,CAAE,KACpB,CACA,OAAOH,CACT,MAAQ,CACN,OAAOA,CACT,CACF,CAGA,SAASK,EAAwBC,EAA4BC,EAAiB,CAC5E,MAAMC,EAA+C,CACnD,wBACA,sBAAA,EAGF,MADI,CAAC,MAAM,QAAQD,CAAK,GACpB,CAACC,EAAkB,SAASF,CAAG,EAAUC,EACtC,CAAC,GAAGA,CAAK,EAAE,MAAA,EAAQ,KAAK,CAACE,EAAGC,IAAM,OAAOD,CAAC,EAAE,cAAc,OAAOC,CAAC,CAAC,CAAC,CAC7E,CAGA,SAASC,EAAeL,EAA4BC,EAAiB,CACnE,MAAMK,EAA6C,CACjD,YAAa,aAAc,iBAAkB,kCAC7C,6BAA8B,YAAa,gBAAiB,oBAC5D,mBAAoB,yBAA0B,cAAe,YAAa,uBAC1E,4BAA6B,6BAAA,EAEzBC,EAA2C,CAC/C,wBAAyB,uBAAwB,+BAAgC,8BAAA,EAEnF,GAAIN,IAAU,OAAW,CACvB,GAAIK,EAAgB,SAASN,CAAG,EAAG,MAAO,GAC1C,GAAIO,EAAc,SAASP,CAAG,QAAU,CAAA,CAC1C,CACA,OAAOC,CACT,CAEO,SAASO,EAAoBC,EAA2D,CAC7F,GAAI,CAACA,EAAO,MAAO,CAAA,EACnB,MAAMC,EAAgC,CAAE,GAAGD,CAAA,EAGvCC,EAAI,sBAAwB,WAAe,oBAAsBjB,EAASiB,EAAI,mBAAmB,GACjGA,EAAI,oBAAsB,WAAe,kBAAoBjB,EAASiB,EAAI,iBAAiB,GAG3FA,EAAI,wBAA0B,SAAWA,EAAI,sBAAwBX,EAAwB,wBAAyBW,EAAI,qBAAqB,GAC/IA,EAAI,uBAAyB,SAAWA,EAAI,qBAAuBX,EAAwB,uBAAwBW,EAAI,oBAAoB,GAG/I,UAAWV,KAAO,OAAO,KAAKU,CAAG,EAC9BA,EAAYV,CAAG,EAAIK,EAAeL,EAAMU,EAAYV,CAAG,CAAC,EAG3D,OAAOU,CACT"}